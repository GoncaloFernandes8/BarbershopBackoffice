<div class="calendar-page">
  <div class="calendar-header">
    <div class="header-top">
      <h1>Calendário</h1>
      <button mat-raised-button color="primary" (click)="onCreateAppointment()" [disabled]="!selectedDate && viewMode === 'month'" class="new-appointment-button">
        <mat-icon>add</mat-icon>
        Nova Marcação
      </button>
    </div>
    
    <div class="calendar-controls">
      <mat-form-field appearance="outline" class="filter-select">
        <mat-label>Barbeiro</mat-label>
        <mat-select [(value)]="selectedBarber" (selectionChange)="onBarberChange()">
          <mat-option value="all">Todos os barbeiros</mat-option>
          <mat-option *ngFor="let barber of barbers" [value]="barber.id">
            {{ barber.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-select">
        <mat-label>Estado</mat-label>
        <mat-select [(value)]="statusFilter" (selectionChange)="onStatusFilterChange()">
          <mat-option value="all">Todas as marcações</mat-option>
          <mat-option value="active">Marcações ativas</mat-option>
          <mat-option value="cancelled">Marcações canceladas</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Botão para alternar entre vistas -->
      <button mat-raised-button (click)="toggleViewMode()" class="view-toggle-button">
        <mat-icon>{{ viewMode === 'month' ? 'calendar_view_day' : 'calendar_view_month' }}</mat-icon>
        {{ viewMode === 'month' ? 'Vista Diária' : 'Vista Mensal' }}
      </button>

      <!-- Navegação para vista mensal -->
      <div class="navigation" *ngIf="viewMode === 'month'">
        <button mat-icon-button (click)="onPreviousMonth()" class="nav-btn">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <span class="nav-date">{{ getMonthYear() }}</span>
        <button mat-icon-button (click)="onNextMonth()" class="nav-btn">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Navegação para vista diária -->
      <div class="navigation" *ngIf="viewMode === 'day'">
        <button mat-icon-button (click)="onPreviousDay()" class="nav-btn">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <span class="nav-date">{{ getDayViewDateFormatted() }}</span>
        <button mat-icon-button (click)="onNextDay()" class="nav-btn">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Vista Mensal -->
  <div class="calendar-container" *ngIf="viewMode === 'month'">
    <div class="calendar-grid">
      <!-- Cabeçalho dos dias da semana -->
      <div class="weekday-header" *ngFor="let day of weekDays">
        {{ day }}
      </div>

      <!-- Dias do calendário -->
      <div 
        class="calendar-day" 
        *ngFor="let day of calendarDays"
        [class.today]="isToday(day)"
        [class.selected]="isSelected(day)"
        [class.other-month]="!isSameMonth(day, currentDate)"
        [class.has-appointments]="getAppointmentsForDate(day).length > 0"
        (click)="onDateClick(day)"
      >
        <div class="day-number">{{ day.getDate() }}</div>
        
        <div class="appointments-list">
          <div 
            class="appointment-chip"
            *ngFor="let appointment of getAppointmentsForDate(day)"
            [class]="'status-' + getStatusColor(appointment.status)"
            [title]="appointment.notes || ''"
          >
            <span class="time">{{ formatTime(appointment.startsAt) }}</span>
            <span class="service">{{ getServiceName(appointment.serviceId) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista Diária -->
  <div class="day-view-container" *ngIf="viewMode === 'day'">
    <div class="day-view-timeline">
      <div class="timeline-hour" *ngFor="let hour of dayViewHours">
        <div class="hour-label">
          {{ hour }}:00
        </div>
        <div class="hour-content">
          <div class="hour-line"></div>
          
          <!-- Marcações nesta hora -->
          <div 
            class="day-appointment"
            *ngFor="let appointment of getAppointmentsForHour(hour)"
            [class]="'status-' + getStatusColor(appointment.status)"
            [title]="appointment.notes || ''"
          >
            <div class="appointment-time-range">
              {{ formatTime(appointment.startsAt) }} - {{ formatTime(appointment.endsAt) }}
            </div>
            <div class="appointment-service">
              {{ getServiceName(appointment.serviceId) }}
            </div>
            <div class="appointment-client">
              {{ getClientName(appointment.clientId) }}
            </div>
            <div class="appointment-barber" *ngIf="selectedBarber === 'all'">
              <mat-icon>person</mat-icon>
              {{ getBarberName(appointment.barberId) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Painel lateral com detalhes da data selecionada -->
  <div class="selected-date-panel" *ngIf="selectedDate">
    <div class="panel-header">
      <h3>{{ format(selectedDate, 'dd/MM/yyyy') }}</h3>
      <button mat-icon-button (click)="selectedDate = null">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="appointments-list">
      <div 
        class="appointment-card"
        *ngFor="let appointment of getAppointmentsForDate(selectedDate)"
      >
        <div class="appointment-time">
          {{ formatTime(appointment.startsAt) }} - {{ formatTime(appointment.endsAt) }}
        </div>
        <div class="appointment-details">
          <div class="service-name">{{ getServiceName(appointment.serviceId) }}</div>
          <div class="client-name">{{ getClientName(appointment.clientId) }}</div>
          <div class="barber-name" *ngIf="selectedBarber === 'all'">
            <mat-icon>person</mat-icon>
            {{ getBarberName(appointment.barberId) }}
          </div>
          <div class="appointment-status">
            <mat-chip [class]="'status-' + getStatusColor(appointment.status)">
              {{ appointment.status }}
            </mat-chip>
          </div>
        </div>
        <div class="appointment-notes" *ngIf="appointment.notes">
          {{ appointment.notes }}
        </div>
      </div>

      <div class="no-appointments" *ngIf="getAppointmentsForDate(selectedDate).length === 0">
        <p>Nenhuma marcação para este dia</p>
        <button mat-button color="primary" (click)="onCreateAppointment()">
          <mat-icon>add</mat-icon>
          Criar Marcação
        </button>
      </div>
    </div>
  </div>
</div>
